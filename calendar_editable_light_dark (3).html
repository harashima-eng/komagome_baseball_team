<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ÈáéÁêÉÈÉ®‰∫àÂÆöË°®ÔΩúÁ∑®ÈõÜÁî®„Ç´„É¨„É≥„ÉÄ„ÉºÔºàDay / Week / MonthÔºâ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #0f172a;
      --bg-soft: #0b1220;
      --bg-card: #020617;
      --bg-card-soft: #020617;
      --accent: #38bdf8;
      --accent-soft: rgba(56, 189, 248, 0.12);
      --accent-strong: #0ea5e9;
      --text-main: #e5e7eb;
      --text-soft: #9ca3af;
      --border-soft: #1f2937;
      --danger: #f97373;
      --danger-soft: rgba(248, 113, 113, 0.12);
      --today-bg: rgba(34, 197, 94, 0.16);
      --today-border: #22c55e;
      --shadow-soft: 0 24px 60px rgba(15, 23, 42, 0.9);
      --radius-lg: 18px;
      --radius-md: 12px;
      --radius-pill: 999px;
      --transition-fast: 160ms ease-out;
      --transition-med: 200ms ease-out;
    }

    body.light {
      --bg: #f3f4f6;
      --bg-soft: #e5e7eb;
      --bg-card: #ffffff;
      --bg-card-soft: #f9fafb;
      --accent: #2563eb;
      --accent-soft: rgba(37, 99, 235, 0.06);
      --accent-strong: #1d4ed8;
      --text-main: #111827;
      --text-soft: #6b7280;
      --border-soft: #d1d5db;
      --danger: #dc2626;
      --danger-soft: rgba(220, 38, 38, 0.08);
      --today-bg: rgba(34, 197, 94, 0.12);
      --today-border: #16a34a;
      --shadow-soft: 0 18px 40px rgba(15, 23, 42, 0.15);
    }

    *,
    *::before,
    *::after {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      background: radial-gradient(circle at top, #1e293b 0, #020617 55%);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: var(--text-main);
      display: flex;
      justify-content: center;
      padding: 18px;
      transition: background var(--transition-med), color 180ms ease-out;
    }

    body.light {
      background: radial-gradient(circle at top, #e5e7eb 0, #ffffff 55%);
    }

    .app-shell {
      width: 100%;
      max-width: 1220px;
      background: linear-gradient(145deg, rgba(15, 23, 42, 0.96), rgba(2, 6, 23, 0.98));
      border-radius: 26px;
      border: 1px solid rgba(148, 163, 184, 0.18);
      box-shadow: var(--shadow-soft);
      padding: 18px 20px 20px;
      display: flex;
      flex-direction: column;
      gap: 14px;
      backdrop-filter: blur(22px);
      transition: background var(--transition-med), border-color 180ms ease-out, box-shadow var(--transition-med);
    }

    body.light .app-shell {
      background: linear-gradient(145deg, rgba(249, 250, 251, 0.98), rgba(229, 231, 235, 0.98));
      border-color: rgba(209, 213, 219, 0.95);
    }

    .header-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }

    .title-block {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .title-main {
      font-size: 1.2rem;
      font-weight: 650;
      letter-spacing: 0.04em;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .title-tag {
      font-size: 0.7rem;
      padding: 2px 8px;
      border-radius: 999px;
      background: var(--accent-soft);
      color: var(--accent-strong);
      border: 1px solid rgba(148, 163, 184, 0.4);
    }

    .title-sub {
      font-size: 0.78rem;
      color: var(--text-soft);
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .btn {
      border-radius: var(--radius-pill);
      border: 1px solid rgba(148, 163, 184, 0.5);
      background: rgba(15, 23, 42, 0.85);
      color: var(--text-main);
      padding: 6px 12px;
      font-size: 0.76rem;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      transition: background var(--transition-fast), border-color var(--transition-fast), transform 120ms ease-out, box-shadow 120ms ease-out, color 120ms ease-out;
      box-shadow: 0 0 0 rgba(15, 23, 42, 0);
      white-space: nowrap;
    }

    body.light .btn {
      background: #ffffff;
    }

    .btn:hover {
      border-color: var(--accent-strong);
      background: radial-gradient(circle at top left, rgba(56, 189, 248, 0.18), rgba(15, 23, 42, 0.96));
      transform: translateY(-1px);
      box-shadow: 0 5px 15px rgba(15, 23, 42, 0.45);
    }

    body.light .btn:hover {
      background: radial-gradient(circle at top left, rgba(37, 99, 235, 0.16), #ffffff);
      box-shadow: 0 5px 14px rgba(148, 163, 184, 0.55);
    }

    .btn-ghost {
      background: transparent;
      border-style: dashed;
    }

    .btn-primary {
      border-color: var(--accent-strong);
      background: linear-gradient(145deg, var(--accent), var(--accent-strong));
      color: #0b1020;
      font-weight: 600;
      box-shadow: 0 10px 30px rgba(56, 189, 248, 0.45);
    }

    .btn-primary:hover {
      background: linear-gradient(145deg, var(--accent-strong), var(--accent));
      box-shadow: 0 12px 34px rgba(56, 189, 248, 0.55);
    }

    .btn-danger {
      border-color: var(--danger);
      background: var(--danger-soft);
      color: #fecaca;
    }

    body.light .btn-danger {
      color: #b91c1c;
    }

    .btn-icon {
      padding: 6px 8px;
      border-radius: 999px;
      font-size: 0.8rem;
      min-width: 32px;
      justify-content: center;
    }

    .btn-toggle {
      position: relative;
      padding-inline: 10px;
    }

    .btn-toggle::after {
      content: "";
      position: absolute;
      inset: 1px;
      border-radius: inherit;
      border: 1px solid rgba(15, 23, 42, 0.2);
      pointer-events: none;
      opacity: 0;
      transition: opacity 150ms ease-out;
    }

    .btn-toggle.active {
      background: var(--accent-soft);
      border-color: var(--accent-strong);
      color: var(--accent-strong);
    }

    .btn-toggle.active::after {
      opacity: 1;
    }

    .toolbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
      padding: 8px 10px;
      border-radius: 16px;
      background: radial-gradient(circle at top, rgba(15, 23, 42, 0.98), rgba(15, 23, 42, 0.94));
      border: 1px solid rgba(148, 163, 184, 0.35);
    }

    body.light .toolbar {
      background: linear-gradient(145deg, rgba(249, 250, 251, 0.97), rgba(229, 231, 235, 0.96));
      border-color: rgba(209, 213, 219, 0.9);
    }

    .toolbar-left,
    .toolbar-right {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .date-label {
      font-size: 0.9rem;
      font-weight: 600;
      padding: 5px 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.8);
      border: 1px solid rgba(148, 163, 184, 0.4);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    body.light .date-label {
      background: #ffffff;
      border-color: rgba(209, 213, 219, 0.9);
    }

    .date-label span.secondary {
      font-size: 0.7rem;
      color: var(--text-soft);
      font-weight: 400;
    }

    .chip-group {
      display: inline-flex;
      padding: 2px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.4);
    }

    body.light .chip-group {
      background: rgba(255, 255, 255, 0.96);
      border-color: rgba(209, 213, 219, 0.9);
    }

    .chip {
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 0.78rem;
      cursor: pointer;
      border: none;
      background: transparent;
      color: var(--text-soft);
      transition: background var(--transition-fast), color var(--transition-fast), transform 120ms ease-out;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .chip.active {
      background: var(--accent-soft);
      color: var(--accent-strong);
      font-weight: 600;
      transform: translateY(-0.5px);
    }

    .chip span.dot {
      display: inline-block;
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--accent-strong);
    }

    .calendar-shell {
      border-radius: 18px;
      background: radial-gradient(circle at top left, rgba(15, 23, 42, 0.96), rgba(15, 23, 42, 0.98));
      border: 1px solid rgba(148, 163, 184, 0.4);
      padding: 12px 12px 10px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      min-height: 430px;
      max-height: 72vh;
    }

    body.light .calendar-shell {
      background: linear-gradient(145deg, rgba(249, 250, 251, 0.97), rgba(229, 231, 235, 0.96));
      border-color: rgba(209, 213, 219, 0.9);
    }

    .weekdays-row {
      display: grid;
      grid-template-columns: repeat(7, minmax(0, 1fr));
      gap: 4px;
      padding-inline: 2px;
      padding-bottom: 2px;
      font-size: 0.74rem;
      color: var(--text-soft);
    }

    .weekdays-row span {
      text-align: center;
      padding: 4px 0;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.4);
    }

    body.light .weekdays-row span {
      background: rgba(255, 255, 255, 0.9);
    }

    .weekdays-row span.sun {
      color: #fb7185;
    }

    .weekdays-row span.sat {
      color: #60a5fa;
    }

    .calendar-grid-month {
      flex: 1;
      display: grid;
      grid-template-columns: repeat(7, minmax(0, 1fr));
      grid-auto-rows: minmax(78px, 1fr);
      gap: 4px;
      overflow: hidden;
    }

    .calendar-cell {
      position: relative;
      border-radius: 14px;
      padding: 6px 6px 4px;
      background: radial-gradient(circle at top left, rgba(15, 23, 42, 0.92), rgba(15, 23, 42, 0.98));
      border: 1px solid rgba(30, 64, 175, 0.45);
      display: flex;
      flex-direction: column;
      gap: 4px;
      overflow: hidden;
      cursor: pointer;
      transition: border-color var(--transition-fast), background var(--transition-fast), transform 120ms ease-out, box-shadow 120ms ease-out;
    }

    body.light .calendar-cell {
      background: radial-gradient(circle at top left, rgba(255, 255, 255, 0.98), rgba(243, 244, 246, 0.98));
      border-color: rgba(209, 213, 219, 0.9);
    }

    .calendar-cell:hover {
      border-color: var(--accent-strong);
      box-shadow: 0 7px 18px rgba(15, 23, 42, 0.55);
      transform: translateY(-1px);
    }

    body.light .calendar-cell:hover {
      box-shadow: 0 6px 14px rgba(148, 163, 184, 0.7);
    }

    .calendar-cell.muted {
      opacity: 0.55;
      background: radial-gradient(circle at bottom right, rgba(15, 23, 42, 0.88), rgba(15, 23, 42, 0.96));
    }

    body.light .calendar-cell.muted {
      background: radial-gradient(circle at bottom right, rgba(248, 250, 252, 0.98), rgba(226, 232, 240, 0.98));
    }

    .calendar-cell.today {
      background: radial-gradient(circle at top left, var(--today-bg), rgba(15, 23, 42, 0.98));
      border-color: var(--today-border);
    }

    body.light .calendar-cell.today {
      background: radial-gradient(circle at top left, rgba(220, 252, 231, 0.96), rgba(249, 250, 251, 0.98));
    }

    .date-chip {
      display: inline-flex;
      align-items: baseline;
      gap: 4px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .date-chip span.main-date {
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.7);
      border: 1px solid rgba(148, 163, 184, 0.6);
    }

    body.light .date-chip span.main-date {
      background: rgba(255, 255, 255, 0.98);
      border-color: rgba(209, 213, 219, 0.9);
    }

    .date-chip span.weekday {
      font-size: 0.7rem;
      color: var(--text-soft);
    }

    .events-list {
      margin-top: 2px;
      display: flex;
      flex-direction: column;
      gap: 3px;
      overflow-y: auto;
      padding-right: 2px;
      scrollbar-width: thin;
    }

    .events-list::-webkit-scrollbar {
      width: 5px;
    }

    .events-list::-webkit-scrollbar-thumb {
      background: rgba(148, 163, 184, 0.7);
      border-radius: 999px;
    }

    .event-pill {
      border-radius: 999px;
      padding: 2px 7px;
      font-size: 0.7rem;
      background: rgba(37, 99, 235, 0.25);
      border: 1px solid rgba(129, 140, 248, 0.7);
      display: flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
      min-height: 18px;
    }

    .event-pill span.time {
      font-variant-numeric: tabular-nums;
      opacity: 0.9;
    }

    .event-pill span.title {
      flex: 1;
      min-width: 0;
      text-overflow: ellipsis;
      overflow: hidden;
    }

    .event-pill.practice {
      background: rgba(22, 163, 74, 0.22);
      border-color: rgba(34, 197, 94, 0.8);
    }

    .event-pill.game {
      background: rgba(248, 113, 113, 0.2);
      border-color: rgba(248, 113, 113, 0.9);
    }

    .event-pill.other {
      background: rgba(14, 165, 233, 0.18);
      border-color: rgba(56, 189, 248, 0.9);
    }

    .calendar-week {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 4px;
      overflow: hidden;
    }

    .calendar-week-header {
      display: grid;
      grid-template-columns: 64px repeat(7, minmax(0, 1fr));
      gap: 4px;
      font-size: 0.74rem;
      color: var(--text-soft);
      padding-inline: 2px;
    }

    .calendar-week-header div {
      text-align: center;
      padding: 4px 0;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.5);
    }

    body.light .calendar-week-header div {
      background: rgba(255, 255, 255, 0.96);
    }

    .calendar-week-body {
      flex: 1;
      display: grid;
      grid-template-columns: 64px repeat(7, minmax(0, 1fr));
      gap: 4px;
      overflow-y: auto;
    }

    .time-col {
      display: flex;
      flex-direction: column;
      gap: 2px;
      font-size: 0.7rem;
      color: var(--text-soft);
      padding-top: 2px;
    }

    .time-slot-label {
      height: 32px;
      display: flex;
      align-items: flex-start;
      justify-content: flex-end;
      padding-right: 4px;
      font-variant-numeric: tabular-nums;
    }

    .day-col {
      border-radius: 14px;
      background: radial-gradient(circle at top left, rgba(15, 23, 42, 0.96), rgba(15, 23, 42, 0.98));
      border: 1px solid rgba(30, 64, 175, 0.5);
      display: flex;
      flex-direction: column;
      padding: 4px;
      gap: 3px;
      min-height: 100%;
      cursor: pointer;
      transition: border-color var(--transition-fast), background var(--transition-fast), transform 120ms ease-out, box-shadow 120ms ease-out;
    }

    body.light .day-col {
      background: radial-gradient(circle at top left, rgba(255, 255, 255, 0.98), rgba(243, 244, 246, 0.98));
      border-color: rgba(209, 213, 219, 0.9);
    }

    .day-col:hover {
      border-color: var(--accent-strong);
      box-shadow: 0 7px 18px rgba(15, 23, 42, 0.6);
      transform: translateY(-1px);
    }

    body.light .day-col:hover {
      box-shadow: 0 6px 14px rgba(148, 163, 184, 0.8);
    }

    .day-col-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      font-size: 0.76rem;
      margin-bottom: 2px;
    }

    .day-col-header span.date {
      font-weight: 600;
    }

    .day-col-header span.weekday {
      font-size: 0.7rem;
      color: var(--text-soft);
    }

    .day-col-events {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 3px;
      overflow-y: auto;
      padding-right: 2px;
      scrollbar-width: thin;
    }

    .day-col-events::-webkit-scrollbar {
      width: 5px;
    }

    .day-col-events::-webkit-scrollbar-thumb {
      background: rgba(148, 163, 184, 0.7);
      border-radius: 999px;
    }


    .calendar-week-vertical {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 6px;
      overflow-y: auto;
    }

    .week-day-row {
      display: flex;
      gap: 8px;
      align-items: flex-start;
      padding: 6px 8px;
      border-radius: 14px;
      background: radial-gradient(circle at top left, rgba(15, 23, 42, 0.96), rgba(15, 23, 42, 0.98));
      border: 1px solid rgba(30, 64, 175, 0.5);
      cursor: pointer;
      transition: border-color var(--transition-fast), background var(--transition-fast), transform 120ms ease-out, box-shadow 120ms ease-out;
    }

    body.light .week-day-row {
      background: radial-gradient(circle at top left, rgba(255, 255, 255, 0.98), rgba(243, 244, 246, 0.98));
      border-color: rgba(209, 213, 219, 0.9);
    }

    .week-day-row.today-row {
      outline: 1px solid var(--today-border);
      box-shadow: 0 7px 18px rgba(15, 23, 42, 0.6);
    }

    .week-day-label {
      min-width: 96px;
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--text-main);
    }

    .week-day-events {
      flex: 1;
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      align-items: flex-start;
    }

    .week-day-empty {
      font-size: 0.75rem;
      color: var(--text-soft);
    }

    .calendar-day-view {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 8px;
      overflow: hidden;
    }

    .calendar-day-header {
      display: flex;
      align-items: baseline;
      gap: 8px;
      font-size: 0.9rem;
    }

    .calendar-day-header .date-main {
      font-size: 1.05rem;
      font-weight: 650;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.86);
      border: 1px solid rgba(148, 163, 184, 0.6);
    }

    body.light .calendar-day-header .date-main {
      background: #ffffff;
      border-color: rgba(209, 213, 219, 0.9);
    }

    .calendar-day-header .date-sub {
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .calendar-day-events {
      flex: 1;
      border-radius: 16px;
      background: radial-gradient(circle at top left, rgba(15, 23, 42, 0.94), rgba(15, 23, 42, 0.98));
      border: 1px solid rgba(30, 64, 175, 0.6);
      padding: 8px 10px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      overflow-y: auto;
    }

    body.light .calendar-day-events {
      background: radial-gradient(circle at top left, rgba(255, 255, 255, 0.99), rgba(243, 244, 246, 0.98));
      border-color: rgba(209, 213, 219, 0.9);
    }

    .calendar-day-events .no-events {
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .event-card {
      border-radius: 12px;
      padding: 6px 8px;
      font-size: 0.78rem;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.7);
      display: flex;
      flex-direction: column;
      gap: 2px;
      cursor: pointer;
      transition: border-color var(--transition-fast), background var(--transition-fast), transform 120ms ease-out, box-shadow 120ms ease-out;
    }

    body.light .event-card {
      background: #ffffff;
      border-color: rgba(209, 213, 219, 0.95);
    }

    .event-card:hover {
      border-color: var(--accent-strong);
      box-shadow: 0 6px 16px rgba(15, 23, 42, 0.65);
      transform: translateY(-1px);
    }

    body.light .event-card:hover {
      box-shadow: 0 6px 16px rgba(148, 163, 184, 0.8);
    }

    .event-card-header {
      display: flex;
      align-items: baseline;
      gap: 6px;
      justify-content: space-between;
    }

    .event-card-title {
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .badge-type {
      padding: 2px 6px;
      border-radius: 999px;
      font-size: 0.65rem;
      letter-spacing: 0.02em;
      text-transform: uppercase;
    }

    .badge-type.practice {
      background: rgba(34, 197, 94, 0.18);
      color: #bbf7d0;
      border: 1px solid rgba(22, 163, 74, 0.9);
    }

    .badge-type.game {
      background: rgba(248, 113, 113, 0.2);
      color: #fee2e2;
      border: 1px solid rgba(248, 113, 113, 0.95);
    }

    .badge-type.other {
      background: rgba(56, 189, 248, 0.2);
      color: #e0f2fe;
      border: 1px solid rgba(56, 189, 248, 0.9);
    }

    body.light .badge-type.practice {
      color: #166534;
    }

    body.light .badge-type.game {
      color: #b91c1c;
    }

    body.light .badge-type.other {
      color: #075985;
    }

    .event-card-time {
      font-size: 0.74rem;
      color: var(--text-soft);
      font-variant-numeric: tabular-nums;
    }

    .event-card-notes {
      font-size: 0.74rem;
      color: var(--text-main);
    }

    .calendar-footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-top: 2px;
      font-size: 0.7rem;
      color: var(--text-soft);
      flex-wrap: wrap;
    }

    .legend {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .legend-item {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.7);
      border: 1px solid rgba(148, 163, 184, 0.7);
    }

    body.light .legend-item {
      background: #ffffff;
      border-color: rgba(209, 213, 219, 0.9);
    }

    .legend-swatch {
      width: 10px;
      height: 10px;
      border-radius: 999px;
    }

    .legend-swatch.practice {
      background: rgba(34, 197, 94, 0.9);
    }

    .legend-swatch.game {
      background: rgba(248, 113, 113, 0.95);
    }

    .legend-swatch.other {
      background: rgba(56, 189, 248, 0.95);
    }

    .last-updated {
      font-size: 0.7rem;
      color: var(--text-soft);
      text-align: right;
    }

    .fab {
      position: fixed;
      right: 18px;
      bottom: 18px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: radial-gradient(circle at top, rgba(15, 23, 42, 0.98), rgba(2, 6, 23, 0.98));
      color: var(--text-main);
      display: inline-flex;
      align-items: center;
      gap: 7px;
      padding: 8px 13px;
      font-size: 0.8rem;
      cursor: pointer;
      box-shadow: 0 16px 40px rgba(15, 23, 42, 0.9);
      z-index: 40;
      transition: background var(--transition-fast), transform 130ms ease-out, box-shadow 130ms ease-out, border-color 150ms ease-out;
    }

    body.light .fab {
      background: radial-gradient(circle at top, #ffffff, #e5e7eb);
      box-shadow: 0 16px 32px rgba(148, 163, 184, 0.75);
    }

    .fab:hover {
      transform: translateY(-1px);
      border-color: var(--accent-strong);
      box-shadow: 0 20px 48px rgba(15, 23, 42, 0.95);
    }

    .fab small {
      opacity: 0.85;
    }

    .fab span.icon {
      font-size: 1rem;
    }

    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 50;
      opacity: 0;
      pointer-events: none;
      transition: opacity 160ms ease-out;
    }

    .modal-backdrop.show {
      opacity: 1;
      pointer-events: auto;
    }

    .modal {
      width: min(420px, 94vw);
      background: radial-gradient(circle at top left, rgba(15, 23, 42, 0.98), rgba(2, 6, 23, 0.98));
      border-radius: 20px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      box-shadow: 0 24px 60px rgba(15, 23, 42, 1);
      padding: 14px 16px 14px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      transform: translateY(10px);
      opacity: 0;
      transition: transform 160ms ease-out, opacity 160ms ease-out;
    }

    body.light .modal {
      background: linear-gradient(145deg, rgba(249, 250, 251, 0.99), rgba(229, 231, 235, 0.99));
      border-color: rgba(209, 213, 219, 0.95);
      box-shadow: 0 24px 50px rgba(148, 163, 184, 0.95);
    }

    .modal-backdrop.show .modal {
      transform: translateY(0);
      opacity: 1;
    }

    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .modal-title {
      font-size: 0.95rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .modal-badge {
      font-size: 0.7rem;
      padding: 2px 7px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.8);
      border: 1px solid rgba(148, 163, 184, 0.7);
      color: var(--text-soft);
    }

    body.light .modal-badge {
      background: #ffffff;
      border-color: rgba(209, 213, 219, 0.95);
    }

    .modal-body {
      display: flex;
      flex-direction: column;
      gap: 8px;
      font-size: 0.8rem;
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 3px;
    }

    .field label {
      font-size: 0.75rem;
      color: var(--text-soft);
    }

    .input,
    .select,
    .textarea {
      border-radius: 10px;
      border: 1px solid rgba(148, 163, 184, 0.8);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-main);
      padding: 6px 8px;
      font-size: 0.8rem;
      outline: none;
      transition: border-color 140ms ease-out, box-shadow 140ms ease-out, background 160ms ease-out;
      font-family: inherit;
    }

    body.light .input,
    body.light .select,
    body.light .textarea {
      background: #ffffff;
      border-color: rgba(209, 213, 219, 0.95);
      color: #111827;
    }

    .input:focus,
    .select:focus,
    .textarea:focus {
      border-color: var(--accent-strong);
      box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.5);
    }

    .textarea {
      min-height: 58px;
      resize: vertical;
    }

    .modal-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-top: 2px;
      flex-wrap: wrap;
    }

    .modal-footer-left,
    .modal-footer-right {
      display: flex;
      align-items: center;
      gap: 6px;
      flex-wrap: wrap;
    }

    .helper-text {
      font-size: 0.7rem;
      color: var(--text-soft);
    }

    .pill {
      border-radius: 999px;
      padding: 2px 8px;
      font-size: 0.7rem;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.8);
      color: var(--text-soft);
    }

    body.light .pill {
      background: #ffffff;
      border-color: rgba(209, 213, 219, 0.95);
    }

    .toast {
      position: fixed;
      left: 50%;
      bottom: 10px;
      transform: translateX(-50%) translateY(20px);
      padding: 6px 12px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.96);
      border: 1px solid rgba(148, 163, 184, 0.9);
      color: #e5e7eb;
      font-size: 0.75rem;
      display: flex;
      align-items: center;
      gap: 6px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 160ms ease-out, transform 160ms ease-out;
      z-index: 60;
    }

    body.light .toast {
      background: rgba(17, 24, 39, 0.98);
      color: #e5e7eb;
      border-color: rgba(55, 65, 81, 0.95);
    }

    .toast.show {
      opacity: 1;
      pointer-events: auto;
      transform: translateX(-50%) translateY(0);
    }

    @media (max-width: 768px) {
      .toolbar {
        flex-direction: column;
        align-items: stretch;
      }

      .toolbar-left,
      .toolbar-right {
        justify-content: space-between;
      }

      .calendar-week-header,
      .calendar-week-body {
        grid-template-columns: 42px repeat(7, minmax(0, 1fr));
      }

      .time-col {
        font-size: 0.68rem;
      }
    }

    @media (max-width: 640px) {
      .header-row {
        flex-direction: column;
        align-items: flex-start;
      }

      .fab {
        right: 12px;
        bottom: 12px;
      }
    }
  </style>
</head>
<body class="light">
  <div class="app-shell">
    <div class="header-row">
      <div class="title-block">
        <div class="title-main">
          ÈáéÁêÉÈÉ®‰∫àÂÆöË°®
          <span class="title-tag">Coach ViewÔΩúÁ∑®ÈõÜOK</span>
        </div>
        <div class="title-sub">
          Êó• / ÈÄ± / Êúà Ë°®Á§∫„ÇíÂàá„ÇäÊõø„Åà„Å™„Åå„Çâ„ÄÅÁ∑¥Áøí„ÉªË©¶Âêà„Éª„Ç™„Éï‰∫àÂÆö„Çí„Åù„ÅÆÂ†¥„ÅßÁ∑®ÈõÜ„Åß„Åç„Åæ„Åô„ÄÇ
        </div>
      </div>
      <div class="header-actions">
        <button id="downloadHtmlBtn" class="btn btn-ghost" type="button">
          <span>‚¨áÔ∏è Download HTML</span>
        </button>
        <button id="themeToggleBtn" class="btn btn-icon" type="button">
          <span class="theme-label">‚òÄÔ∏è Light</span>
        </button>
      </div>
    </div>

    <div class="toolbar">
      <div class="toolbar-left">
        <button id="prevBtn" class="btn btn-icon" type="button">‚Üê</button>
        <button id="todayBtn" class="btn btn-ghost" type="button">Today</button>
        <button id="nextBtn" class="btn btn-icon" type="button">‚Üí</button>
        <div class="date-label">
          <span id="dateLabelMain"></span>
          <span id="dateLabelSub" class="secondary"></span>
        </div>
      </div>
      <div class="toolbar-right">
        <div class="chip-group" aria-label="View mode">
          <button type="button" class="chip active" data-view="month">
            <span class="dot"></span> Month
          </button>
          <button type="button" class="chip" data-view="week">
            Week
          </button>
          <button type="button" class="chip" data-view="day">
            Day
          </button>
        </div>
        <button id="newEventBtn" class="btn btn-primary" type="button">
          <span>Ôºã Add Event</span>
        </button>
      </div>
    </div>

    <div class="calendar-shell">
      <div id="calendarWeekdays" class="weekdays-row" aria-hidden="true"></div>
      <div id="calendarContent"></div>
      <div class="calendar-footer">
        <div class="legend">
          <div class="legend-item">
            <span class="legend-swatch practice"></span>
            <span>Practice</span>
          </div>
          <div class="legend-item">
            <span class="legend-swatch game"></span>
            <span>Game</span>
          </div>
          <div class="legend-item">
            <span class="legend-swatch other"></span>
            <span>Other / Meeting</span>
          </div>
        </div>
        <div class="last-updated" id="lastUpdated"></div>
      </div>
    </div>
  </div>

  <button id="fabNewEvent" class="fab" type="button">
    <span class="icon">Ôºã</span>
    <small>Êñ∞„Åó„ÅÑ‰∫àÂÆö</small>
  </button>

  <div id="modalBackdrop" class="modal-backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modal-header">
        <div class="modal-title" id="modalTitle">
          <span id="modalTitleText">‰∫àÂÆö„ÇíËøΩÂä†</span>
          <span class="modal-badge" id="modalDateBadge"></span>
        </div>
        <button id="closeModalBtn" class="btn btn-icon" type="button">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="field">
          <label for="eventTitle">„Çø„Ç§„Éà„É´Ôºà‰æãÔºöÊîæË™≤ÂæåÁ∑¥ÁøíÔºâ</label>
          <input id="eventTitle" class="input" type="text" placeholder="„Çø„Ç§„Éà„É´„ÇíÂÖ•Âäõ" />
        </div>
        <div class="field">
          <label for="eventType">Á®ÆÈ°û</label>
          <select id="eventType" class="select">
            <option value="practice">PracticeÔΩúÁ∑¥Áøí</option>
            <option value="game">GameÔΩúË©¶Âêà</option>
            <option value="other">OtherÔΩú„Åù„ÅÆ‰ªñ</option>
          </select>
        </div>
        <div class="field">
          <label>Êó•‰ªò</label>
          <input id="eventDate" class="input" type="date" />
        </div>
        <div class="field">
          <label>ÊôÇÈñìÔºà‰ªªÊÑèÔºâ</label>
          <div style="display:flex; gap:6px;">
            <input id="eventStartTime" class="input" type="time" />
            <span style="align-self:center; font-size:0.75rem; color:var(--text-soft);">„Äú</span>
            <input id="eventEndTime" class="input" type="time" />
          </div>
        </div>
        <div class="field">
          <label for="eventNotes">„É°„É¢ÔºàÂ†¥ÊâÄ / ÊåÅ„Å°Áâ© „Å™„Å©Ôºâ</label>
          <textarea id="eventNotes" class="textarea" placeholder="‰æãÔºöÊ†°Â∫≠ÈõÜÂêà 16:00 / „É¶„Éã„Éï„Ç©„Éº„É†‰∏ÄÂºè„ÉªÊ∞¥Á≠í"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <div class="modal-footer-left">
          <span class="helper-text">ÁîüÂæí„Å´Ë¶ã„Åõ„ÇãÂâç„Å´„Åì„Åì„Åß‰∫àÂÆö„ÇíÂõ∫„ÇÅ„Å¶„Åã„ÇâÂÖ¨Èñã„ÄÇ</span>
        </div>
        <div class="modal-footer-right">
          <button id="deleteEventBtn" class="btn btn-danger" type="button" style="display:none;">Delete</button>
          <button id="saveEventBtn" class="btn btn-primary" type="button">Save</button>
        </div>
      </div>
    </div>
  </div>

  <div id="toast" class="toast">
    <span id="toastText"></span>
  </div>

  <script>
    (function () {
      const STORAGE_KEY = "yb_calendar_events_v1";
      const THEME_KEY = "yb_calendar_theme_v1";

      const weekdayLabels = ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"];
      const weekdayLabelsJP = ["Êúà", "ÁÅ´", "Ê∞¥", "Êú®", "Èáë", "Âúü", "Êó•"];

      let currentView = "month";
      let currentDate = new Date();
      let events = loadEvents();
      let editingEventId = null;

      const calendarContentEl = document.getElementById("calendarContent");
      const calendarWeekdaysEl = document.getElementById("calendarWeekdays");
      const dateLabelMainEl = document.getElementById("dateLabelMain");
      const dateLabelSubEl = document.getElementById("dateLabelSub");
      const lastUpdatedEl = document.getElementById("lastUpdated");

      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");
      const todayBtn = document.getElementById("todayBtn");
      const chipButtons = document.querySelectorAll(".chip-group .chip");
      const themeToggleBtn = document.getElementById("themeToggleBtn");
      const themeLabelEl = themeToggleBtn.querySelector(".theme-label");

      const modalBackdrop = document.getElementById("modalBackdrop");
      const closeModalBtn = document.getElementById("closeModalBtn");
      const newEventBtn = document.getElementById("newEventBtn");
      const fabNewEvent = document.getElementById("fabNewEvent");
      const saveEventBtn = document.getElementById("saveEventBtn");
      const deleteEventBtn = document.getElementById("deleteEventBtn");

      const eventTitleInput = document.getElementById("eventTitle");
      const eventTypeSelect = document.getElementById("eventType");
      const eventDateInput = document.getElementById("eventDate");
      const eventStartTimeInput = document.getElementById("eventStartTime");
      const eventEndTimeInput = document.getElementById("eventEndTime");
      const eventNotesInput = document.getElementById("eventNotes");
      const modalTitleTextEl = document.getElementById("modalTitleText");
      const modalDateBadgeEl = document.getElementById("modalDateBadge");

      const toastEl = document.getElementById("toast");
      const toastTextEl = document.getElementById("toastText");
      const downloadHtmlBtn = document.getElementById("downloadHtmlBtn");

      initTheme();
      renderWeekdayHeader();
      renderAll();

      prevBtn.addEventListener("click", () => {
        if (currentView === "month") {
          currentDate.setMonth(currentDate.getMonth() - 1);
        } else if (currentView === "week") {
          currentDate.setDate(currentDate.getDate() - 7);
        } else {
          currentDate.setDate(currentDate.getDate() - 1);
        }
        renderAll();
      });

      nextBtn.addEventListener("click", () => {
        if (currentView === "month") {
          currentDate.setMonth(currentDate.getMonth() + 1);
        } else if (currentView === "week") {
          currentDate.setDate(currentDate.getDate() + 7);
        } else {
          currentDate.setDate(currentDate.getDate() + 1);
        }
        renderAll();
      });

      todayBtn.addEventListener("click", () => {
        currentDate = new Date();
        renderAll();
      });

      chipButtons.forEach(btn => {
        btn.addEventListener("click", () => {
          chipButtons.forEach(b => b.classList.remove("active"));
          btn.classList.add("active");
          currentView = btn.getAttribute("data-view");
          renderAll();
        });
      });

      themeToggleBtn.addEventListener("click", () => {
        const isLight = document.body.classList.toggle("light");
        themeLabelEl.textContent = isLight ? "‚òÄÔ∏è Light" : "üåô Dark";
        localStorage.setItem(THEME_KEY, isLight ? "light" : "dark");
      });

      newEventBtn.addEventListener("click", () => openModalForNew(currentDate));
      fabNewEvent.addEventListener("click", () => openModalForNew(currentDate));

      closeModalBtn.addEventListener("click", closeModal);
      modalBackdrop.addEventListener("click", (e) => {
        if (e.target === modalBackdrop) {
          closeModal();
        }
      });

      saveEventBtn.addEventListener("click", () => {
        const title = eventTitleInput.value.trim();
        const type = eventTypeSelect.value;
        const dateStr = eventDateInput.value;
        const start = eventStartTimeInput.value;
        const end = eventEndTimeInput.value;
        const notes = eventNotesInput.value.trim();

        if (!dateStr) {
          showToast("Êó•‰ªò„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ");
          return;
        }
        if (!title) {
          showToast("„Çø„Ç§„Éà„É´„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ");
          return;
        }

        if (editingEventId) {
          events = events.map(ev => {
            if (ev.id === editingEventId) {
              return { ...ev, title, type, date: dateStr, start, end, notes };
            }
            return ev;
          });
          showToast("‰∫àÂÆö„ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü„ÄÇ");
        } else {
          const id = "ev_" + Date.now() + "_" + Math.random().toString(16).slice(2);
          events.push({ id, title, type, date: dateStr, start, end, notes });
          showToast("‰∫àÂÆö„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü„ÄÇ");
        }

        saveEvents();
        closeModal();
        renderAll();
      });

      deleteEventBtn.addEventListener("click", () => {
        if (!editingEventId) return;
        if (!confirm("„Åì„ÅÆ‰∫àÂÆö„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü")) return;
        events = events.filter(ev => ev.id !== editingEventId);
        saveEvents();
        showToast("‰∫àÂÆö„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü„ÄÇ");
        closeModal();
        renderAll();
      });

      downloadHtmlBtn.addEventListener("click", () => {
        const html = "<!DOCTYPE html>\n" + document.documentElement.outerHTML;
        const blob = new Blob([html], { type: "text/html;charset=utf-8" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "calendar_editable_light_dark.html";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        showToast("HTML „Éï„Ç°„Ç§„É´„Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Åó„Åæ„Åó„Åü„ÄÇ");
      });

      function renderAll() {
        renderHeader();
        renderView();
        renderLastUpdated();
      }

      function renderHeader() {
        const y = currentDate.getFullYear();
        const m = currentDate.getMonth() + 1;

        if (currentView === "month") {
          dateLabelMainEl.textContent = y + "Âπ¥ " + m + "Êúà";
          dateLabelSubEl.textContent = "ÊúàÈñì„Ç´„É¨„É≥„ÉÄ„Éº";
        } else if (currentView === "week") {
          const range = getWeekRange(currentDate);
          const start = range.start;
          const end = range.end;
          dateLabelMainEl.textContent =
            start.getFullYear() +
            "/" +
            pad(start.getMonth() + 1) +
            "/" +
            pad(start.getDate()) +
            " „Äú " +
            end.getFullYear() +
            "/" +
            pad(end.getMonth() + 1) +
            "/" +
            pad(end.getDate());
          dateLabelSubEl.textContent = "ÈÄ±Èñì„Ç´„É¨„É≥„ÉÄ„Éº";
        } else {
          dateLabelMainEl.textContent =
            y + "/" + pad(m) + "/" + pad(currentDate.getDate());
          dateLabelSubEl.textContent = weekdayLabelsJP[currentDate.getDay() === 0 ? 6 : currentDate.getDay() - 1] + "ÊõúÊó•Ôºà1Êó•Ë°®Á§∫Ôºâ";
        }
      }

      function renderView() {
        calendarContentEl.innerHTML = "";
        if (currentView === "month") {
          calendarWeekdaysEl.style.display = "grid";
          renderMonthView();
        } else if (currentView === "week") {
          calendarWeekdaysEl.style.display = "none";
          renderWeekView();
        } else {
          calendarWeekdaysEl.style.display = "none";
          renderDayView();
        }
      }

      function renderWeekdayHeader() {
        calendarWeekdaysEl.innerHTML = "";
        const jp = ["Êúà", "ÁÅ´", "Ê∞¥", "Êú®", "Èáë", "Âúü", "Êó•"];
        jp.forEach((label, idx) => {
          const span = document.createElement("span");
          span.textContent = label;
          if (idx === 0) span.classList.add("mon");
          if (idx === 5) span.classList.add("sat");
          if (idx === 6) span.classList.add("sun");
          calendarWeekdaysEl.appendChild(span);
        });
      }

      function renderMonthView() {
        const grid = document.createElement("div");
        grid.className = "calendar-grid-month";

        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        const firstDayOfMonth = new Date(year, month, 1);
        const lastDayOfMonth = new Date(year, month + 1, 0);

        const start = startOfWeek(firstDayOfMonth);
        const end = endOfWeek(lastDayOfMonth);

        const today = new Date();
        today.setHours(0, 0, 0, 0);

        for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
          const date = new Date(d);
          const cell = document.createElement("div");
          cell.className = "calendar-cell";

          if (date.getMonth() !== month) {
            cell.classList.add("muted");
          }

          const dateNoTime = new Date(date);
          dateNoTime.setHours(0, 0, 0, 0);
          if (dateNoTime.getTime() === today.getTime()) {
            cell.classList.add("today");
          }

          const dateChip = document.createElement("div");
          dateChip.className = "date-chip";
          const mainDateSpan = document.createElement("span");
          mainDateSpan.className = "main-date";
          mainDateSpan.textContent = date.getDate();
          const weekdaySpan = document.createElement("span");
          weekdaySpan.className = "weekday";
          weekdaySpan.textContent = weekdayLabelsJP[(date.getDay() + 6) % 7];

          dateChip.appendChild(mainDateSpan);
          dateChip.appendChild(weekdaySpan);
          cell.appendChild(dateChip);

          const eventsList = document.createElement("div");
          eventsList.className = "events-list";

          const dateKey = toDateKey(date);
          const dayEvents = events
            .filter(ev => ev.date === dateKey)
            .sort(compareEventsByTimeThenType);

          dayEvents.forEach(ev => {
            const pill = document.createElement("div");
            pill.className = "event-pill " + (ev.type || "other");
            const timeSpan = document.createElement("span");
            timeSpan.className = "time";
            timeSpan.textContent = formatTimeRangeShort(ev.start, ev.end);
            const titleSpan = document.createElement("span");
            titleSpan.className = "title";
            titleSpan.textContent = ev.title;

            pill.appendChild(timeSpan);
            pill.appendChild(titleSpan);
            pill.addEventListener("click", (e) => {
              e.stopPropagation();
              openModalForEdit(ev);
            });
            eventsList.appendChild(pill);
          });

          cell.appendChild(eventsList);
          cell.addEventListener("click", () => openModalForNew(date));
          grid.appendChild(cell);
        }

        calendarContentEl.appendChild(grid);
      }


      function renderWeekView() {
        const wrapper = document.createElement("div");
        wrapper.className = "calendar-week-vertical";

        const range = getWeekRange(currentDate);
        const today = new Date();
        today.setHours(0, 0, 0, 0);

        for (let d = new Date(range.start); d <= range.end; d.setDate(d.getDate() + 1)) {
          const dayDate = new Date(d);
          const dayRow = document.createElement("div");
          dayRow.className = "week-day-row";

          const dateNoTime = new Date(dayDate);
          dateNoTime.setHours(0, 0, 0, 0);
          if (dateNoTime.getTime() === today.getTime()) {
            dayRow.classList.add("today-row");
          }

          const label = document.createElement("div");
          label.className = "week-day-label";
          const jpWd = weekdayLabelsJP[(dayDate.getDay() + 6) % 7];
          label.textContent =
            (dayDate.getMonth() + 1) + "/" + dayDate.getDate() + " (" + jpWd + ")";

          const eventsBox = document.createElement("div");
          eventsBox.className = "week-day-events";

          const dateKey = toDateKey(dayDate);
          const dayEvents = events
            .filter(ev => ev.date === dateKey)
            .sort(compareEventsByTimeThenType);

          if (dayEvents.length === 0) {
            const empty = document.createElement("span");
            empty.className = "week-day-empty";
            empty.textContent = "‰∫àÂÆö„Å™„Åó";
            eventsBox.appendChild(empty);
          } else {
            dayEvents.forEach(ev => {
              const pill = document.createElement("div");
              pill.className = "event-pill " + (ev.type || "other");

              const timeSpan = document.createElement("span");
              timeSpan.className = "time";
              timeSpan.textContent = formatTimeRangeShort(ev.start, ev.end);

              const titleSpan = document.createElement("span");
              titleSpan.className = "title";
              titleSpan.textContent = ev.title;

              pill.appendChild(timeSpan);
              pill.appendChild(titleSpan);

              pill.addEventListener("click", (e) => {
                e.stopPropagation();
                openModalForEdit(ev);
              });

              eventsBox.appendChild(pill);
            });
          }

          dayRow.appendChild(label);
          dayRow.appendChild(eventsBox);

          dayRow.addEventListener("click", () => openModalForNew(dayDate));

          wrapper.appendChild(dayRow);
        }

        calendarContentEl.appendChild(wrapper);
      }

      function renderDayView() {
        const wrapper = document.createElement("div");
        wrapper.className = "calendar-day-view";

        const header = document.createElement("div");
        header.className = "calendar-day-header";

        const dateMain = document.createElement("div");
        dateMain.className = "date-main";
        dateMain.textContent =
          currentDate.getFullYear() + "/" +
          pad(currentDate.getMonth() + 1) + "/" +
          pad(currentDate.getDate());

        const dateSub = document.createElement("div");
        dateSub.className = "date-sub";
        const wdIndex = (currentDate.getDay() + 6) % 7;
        dateSub.textContent = weekdayLabelsJP[wdIndex] + "ÊõúÊó• | 1Êó•Ë°®Á§∫";

        header.appendChild(dateMain);
        header.appendChild(dateSub);
        wrapper.appendChild(header);

        const eventsBox = document.createElement("div");
        eventsBox.className = "calendar-day-events";

        const dateKey = toDateKey(currentDate);
        const dayEvents = events
          .filter(ev => ev.date === dateKey)
          .sort(compareEventsByTimeThenType);

        if (dayEvents.length === 0) {
          const empty = document.createElement("div");
          empty.className = "no-events";
          empty.textContent = "‰∫àÂÆö„ÅØÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇÔºã„Éú„Çø„É≥„Åã„ÇâËøΩÂä†„Åß„Åç„Åæ„Åô„ÄÇ";
          eventsBox.appendChild(empty);
        } else {
          dayEvents.forEach(ev => {
            const card = document.createElement("div");
            card.className = "event-card";

            const headerRow = document.createElement("div");
            headerRow.className = "event-card-header";

            const titleWrap = document.createElement("div");
            titleWrap.className = "event-card-title";
            const titleSpan = document.createElement("span");
            titleSpan.textContent = ev.title;

            const badge = document.createElement("span");
            const type = ev.type || "other";
            badge.className = "badge-type " + type;
            badge.textContent =
              type === "practice" ? "Practice" :
              type === "game" ? "Game" :
              "Other";

            titleWrap.appendChild(titleSpan);
            titleWrap.appendChild(badge);
            headerRow.appendChild(titleWrap);

            const timeSpan = document.createElement("div");
            timeSpan.className = "event-card-time";
            timeSpan.textContent = formatTimeRange(ev.start, ev.end);
            headerRow.appendChild(timeSpan);

            const notes = document.createElement("div");
            notes.className = "event-card-notes";
            notes.textContent = ev.notes || "";

            card.appendChild(headerRow);
            if (ev.start || ev.end) {
              card.appendChild(timeSpan);
            }
            if (ev.notes) {
              card.appendChild(notes);
            }

            card.addEventListener("click", () => openModalForEdit(ev));
            eventsBox.appendChild(card);
          });
        }

        wrapper.appendChild(eventsBox);
        calendarContentEl.appendChild(wrapper);
      }

      function renderLastUpdated() {
        const last = localStorage.getItem(STORAGE_KEY + "_updated_at");
        if (!last) {
          lastUpdatedEl.textContent = "„Åæ„Å†‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì";
          return;
        }
        lastUpdatedEl.textContent = "Last saved: " + last;
      }

      function openModalForNew(date) {
        editingEventId = null;
        modalTitleTextEl.textContent = "‰∫àÂÆö„ÇíËøΩÂä†";
        deleteEventBtn.style.display = "none";

        const dateKey = toDateKey(date);
        eventTitleInput.value = "";
        eventTypeSelect.value = "practice";
        eventDateInput.value = dateKey;
        eventStartTimeInput.value = "";
        eventEndTimeInput.value = "";
        eventNotesInput.value = "";

        modalDateBadgeEl.textContent =
          date.getFullYear() +
          "/" +
          pad(date.getMonth() + 1) +
          "/" +
          pad(date.getDate()) +
          " (" +
          weekdayLabelsJP[(date.getDay() + 6) % 7] +
          ")";

        openModal();
      }

      function openModalForEdit(ev) {
        editingEventId = ev.id;
        modalTitleTextEl.textContent = "‰∫àÂÆö„ÇíÁ∑®ÈõÜ";
        deleteEventBtn.style.display = "inline-flex";

        eventTitleInput.value = ev.title || "";
        eventTypeSelect.value = ev.type || "other";
        eventDateInput.value = ev.date || "";
        eventStartTimeInput.value = ev.start || "";
        eventEndTimeInput.value = ev.end || "";
        eventNotesInput.value = ev.notes || "";

        const d = dateFromKey(ev.date);
        modalDateBadgeEl.textContent =
          d.getFullYear() +
          "/" +
          pad(d.getMonth() + 1) +
          "/" +
          pad(d.getDate()) +
          " (" +
          weekdayLabelsJP[(d.getDay() + 6) % 7] +
          ")";

        openModal();
      }

      function openModal() {
        modalBackdrop.classList.add("show");
        modalBackdrop.setAttribute("aria-hidden", "false");
        setTimeout(() => {
          eventTitleInput.focus();
        }, 40);
      }

      function closeModal() {
        modalBackdrop.classList.remove("show");
        modalBackdrop.setAttribute("aria-hidden", "true");
        editingEventId = null;
      }

      function loadEvents() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if (!raw) return [];
          const parsed = JSON.parse(raw);
          if (!Array.isArray(parsed)) return [];
          return parsed;
        } catch (e) {
          console.error("Failed to load events", e);
          return [];
        }
      }

      function saveEvents() {
        try {
          localStorage.setItem(STORAGE_KEY, JSON.stringify(events));
          const now = new Date();
          const stamp =
            now.getFullYear() +
            "/" +
            pad(now.getMonth() + 1) +
            "/" +
            pad(now.getDate()) +
            " " +
            pad(now.getHours()) +
            ":" +
            pad(now.getMinutes());
          localStorage.setItem(STORAGE_KEY + "_updated_at", stamp);
        } catch (e) {
          console.error("Failed to save events", e);
        }
        renderLastUpdated();
      }

      function startOfWeek(date) {
        const d = new Date(date);
        const day = d.getDay();
        const diff = (day === 0 ? -6 : 1) - day;
        d.setDate(d.getDate() + diff);
        d.setHours(0, 0, 0, 0);
        return d;
      }

      function endOfWeek(date) {
        const start = startOfWeek(date);
        const end = new Date(start);
        end.setDate(start.getDate() + 6);
        end.setHours(23, 59, 59, 999);
        return end;
      }

      function getWeekRange(date) {
        const start = startOfWeek(date);
        const end = endOfWeek(date);
        return { start, end };
      }

      function toDateKey(date) {
        const d = new Date(date);
        return d.getFullYear() + "-" + pad(d.getMonth() + 1) + "-" + pad(d.getDate());
      }

      function dateFromKey(key) {
        const [y, m, d] = key.split("-").map(Number);
        return new Date(y, m - 1, d);
      }

      function pad(n) {
        return n.toString().padStart(2, "0");
      }

      function compareEventsByTimeThenType(a, b) {
        const at = a.start || "";
        const bt = b.start || "";
        if (at && bt && at !== bt) {
          return at < bt ? -1 : 1;
        }
        const typeOrder = { game: 0, practice: 1, other: 2 };
        const ao = typeOrder[a.type] ?? 3;
        const bo = typeOrder[b.type] ?? 3;
        return ao - bo;
      }

      function formatTimeRangeShort(start, end) {
        if (!start && !end) return "All day";
        if (start && !end) return start;
        if (!start && end) return "„Äú" + end;
        return start + "‚Äì" + end;
      }

      function formatTimeRange(start, end) {
        if (!start && !end) return "All day / ÁµÇÊó•";
        if (start && !end) return start + " „Äú";
        if (!start && end) return "„Äú " + end;
        return start + " „Äú " + end;
      }

      function showToast(message) {
        toastTextEl.textContent = message;
        toastEl.classList.add("show");
        setTimeout(() => {
          toastEl.classList.remove("show");
        }, 1800);
      }

      function initTheme() {
        const stored = localStorage.getItem(THEME_KEY);
        if (stored === "dark") {
          document.body.classList.remove("light");
          themeLabelEl.textContent = "üåô Dark";
        } else {
          document.body.classList.add("light");
          themeLabelEl.textContent = "‚òÄÔ∏è Light";
        }
      }
    })();
  </script>
</body>
</html>
